#!/usr/bin/python3

import json

from utils import *


def extract_duplicate(src1: Dict[Any, Any], src2: Dict[Any, Any]) -> Dict[Any, Any]:
    duplicate = {key: src1[key] for key in src1 if key in src2 and src1[key] == src2[key]}

    exec_all(src1.pop, duplicate.keys(), parallel=False)
    exec_all(src2.pop, duplicate.keys(), parallel=False)

    return duplicate


if __name__ == "__main__":
    parser = ArgumentParser(description="Get Public IP Address")

    args = parser.parse_args()

    res = exec_all(read_webpage, ["https://v4.ident.me/json", "https://v6.ident.me/json"])

    if not res[0] and not res[1]:
        print("Error: Could not get IP Address")
        exit(1)

    if not res[0]:
        obj = json.loads(res[1])
    
    elif not res[1]:
        obj = json.loads(res[0])

    else:
        ipv4 = json.loads(res[0])
        ipv6 = json.loads(res[1])
        obj = {"ipv4": ipv4, "ipv6": ipv6, **extract_duplicate(ipv4, ipv6)}

    print(json.dumps(obj, indent=2))
